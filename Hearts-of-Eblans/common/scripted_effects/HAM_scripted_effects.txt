# CREATED BY CLR62 - 2025
# Licensed under CC BY-NC-SA 4.0 for END USERS only
# Full license: https://creativecommons.org/licenses/by-nc-sa/4.0/
# 
# Paradox Interactive retains all rights to Hearts of Iron IV
# Available on GitHub and Steam Workshop
 
weak_star_popularity_increase = {

	random_list = {
        40 = {
            add_popularity = {
                ideology = democratic
                popularity = 0.02
            }
        }
        35 = {
            add_popularity = {
                ideology = democratic
                popularity = 0.03
            }
        }
        25 = {
            add_popularity = {
                ideology = democratic
                popularity = 0.04
            }
        }
    }

}

medium_star_popularity_increase = {

	random_list = {
        40 = {
            add_popularity = {
                ideology = democratic
                popularity = 0.05
            }
        }
        35 = {
            add_popularity = {
                ideology = democratic
                popularity = 0.06
            }
        }
        25 = {
            add_popularity = {
                ideology = democratic
                popularity = 0.07
            }
        }
    }
}

strong_star_popularity_increase = {

	random_list = {
        40 = {
            add_popularity = {
                ideology = democratic
                popularity = 0.08
            }
        }
        35 = {
            add_popularity = {
                ideology = democratic
                popularity = 0.09
            }
        }
        25 = {
            add_popularity = {
                ideology = democratic
                popularity = 0.1
            }
        }
    }

}


weak_siloviki_increase = {

    

	    random_list = {
            40 = {
                add_to_variable = { HAM_STAR_siloviki_interes = 2 }
            }
            35 = {
                add_to_variable = { HAM_STAR_siloviki_interes = 3 }
            }
            25 = {
                add_to_variable = { HAM_STAR_siloviki_interes = 4 }
            }
        }

        clamp_variable = {
            var = HAM_STAR_siloviki_interes
            min = 0
            max = 100
        }

        check_siloviki_events = yes

}

medium_siloviki_increase = {

	random_list = {
        40 = {
            add_to_variable = { HAM_STAR_siloviki_interes = 5 }
        }
        35 = {
            add_to_variable = { HAM_STAR_siloviki_interes = 6 }
        }
        25 = {
            add_to_variable = { HAM_STAR_siloviki_interes = 7 }
        }
    }

    clamp_variable = {
        var = HAM_STAR_siloviki_interes
        min = 0
        max = 100
    }

    check_siloviki_events = yes

}

strong_siloviki_increase = {

	random_list = {
        40 = {
            add_to_variable = { HAM_STAR_siloviki_interes = 8 }
        }
        35 = {
            add_to_variable = { HAM_STAR_siloviki_interes = 9 }
        }
        25 = {
            add_to_variable = { HAM_STAR_siloviki_interes = 10 }
        }
    }

    clamp_variable = {
        var = HAM_STAR_siloviki_interes
        min = 0
        max = 100
    }

    check_siloviki_events = yes

}

check_siloviki_events = {
    # При достижении порогов заинтересованности силовики предпринимают действия
    
    # Порог 25% - Слежка за активистами
    if = {
        limit = {
            check_variable = { HAM_STAR_siloviki_interes > 24 }
            NOT = { has_country_flag = HAM_siloviki_stage_1 }
        }
        country_event = { id = hametova.70 days = 3 random_days = 5 }
    }
    
    # Порог 40% - Обыски в штабах
    if = {
        limit = {
            check_variable = { HAM_STAR_siloviki_interes > 39 }
            has_country_flag = HAM_siloviki_stage_1
            NOT = { has_country_flag = HAM_siloviki_stage_2 }
        }

        country_event = { id = hametova.71 days = 2 random_days = 4 }
    }
    
    # Порог 55% - Давление на СМИ
    if = {
        limit = {
            check_variable = { HAM_STAR_siloviki_interes > 54 }
            has_country_flag = HAM_siloviki_stage_2
            NOT = { has_country_flag = HAM_siloviki_stage_3 }
        }
            country_event = { id = hametova.72 days = 2 random_days = 3 }
    }
    
    # Порог 70% - Аресты активистов
    if = {
        limit = {
            check_variable = { HAM_STAR_siloviki_interes > 69 }
            has_country_flag = HAM_siloviki_stage_3
            NOT = { has_country_flag = HAM_siloviki_stage_4 }
        }
        random_list = {
            75 = {
                country_event = { id = hametova.73 days = 1 random_days = 3 }
            }
            25 = {
                # Ничего не происходит
            }
        }
    }
    
    # Порог 85% - Попытка ареста Миланы Стар
    if = {
        limit = {
            check_variable = { HAM_STAR_siloviki_interes > 84 }
            has_country_flag = HAM_siloviki_stage_4
            NOT = { has_country_flag = HAM_siloviki_stage_5 }
        }
            country_event = { id = hametova.74 days = 1 random_days = 2 }
    }
    
    # Порог 95% - Полный разгром оппозиции
    if = {
        limit = {
            check_variable = { HAM_STAR_siloviki_interes > 94 }
            has_country_flag = HAM_siloviki_stage_5
            NOT = { has_country_flag = HAM_siloviki_stage_final }
        }
        country_event = { id = hametova.75 days = 1 }
    }
}

# Эффект для снижения заинтересованности силовиков (можно использовать в событиях)
reduce_siloviki_interest_weak = {
    add_to_variable = { HAM_STAR_siloviki_interes = -5 }
    clamp_variable = {
        var = HAM_STAR_siloviki_interes
        min = 0
        max = 100
    }
}

reduce_siloviki_interest_medium = {
    add_to_variable = { HAM_STAR_siloviki_interes = -10 }
    clamp_variable = {
        var = HAM_STAR_siloviki_interes
        min = 0
        max = 100
    }
}

reduce_siloviki_interest_strong = {
    add_to_variable = { HAM_STAR_siloviki_interes = -20 }
    clamp_variable = {
        var = HAM_STAR_siloviki_interes
        min = 0
        max = 100
    }
}

star_fire_and_disable_advisors = {
    star_opposition_clear_left_advisor = yes
    star_opposition_clear_right_advisor = yes
	set_variable = { HAM_STAR_ADD_ADVISOR = 0}
	set_country_flag = HAM_STAR_ADVISOR_SET_COOLDOWN
    if = {
        limit = {
            NOT = {
                check_variable = { STAR_FIRING_TIME = 0 }
            }
        }
	    set_variable = { HAM_STAR_COOLDOWN = STAR_FIRING_TIME }
    }
    else = {
        set_variable = { HAM_STAR_COOLDOWN = 90 }
    }

    set_variable = { STAR_FIRING_TIME = 0 }
}



star_opposition_ideas_change_state = {

    if = {
        limit = { check_variable = { star_opposition_ideas_new_state = 3}}

        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_2_weak_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_2_weak_idea
                add_idea = HAM_hamway_star_opposition_3_weak_idea
            }
        }
        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_2_medium_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_2_medium_idea
                add_idea = HAM_hamway_star_opposition_3_medium_idea
            }
        }
        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_2_strenght_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_2_strenght_idea
                add_idea = HAM_hamway_star_opposition_3_strenght_idea
            }
        }
        


        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_1_weak_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_1_weak_idea
                add_idea = HAM_hamway_star_opposition_3_weak_idea
            }
        }
        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_1_medium_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_1_medium_idea
                add_idea = HAM_hamway_star_opposition_3_medium_idea
            }
        }
        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_1_strenght_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_1_strenght_idea
                add_idea = HAM_hamway_star_opposition_3_strenght_idea
            }
        }

        
    }

	if = {
        limit = { check_variable = { star_opposition_ideas_new_state = 2}}

        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_3_weak_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_3_weak_idea
                add_idea = HAM_hamway_star_opposition_2_weak_idea
            }
        }
        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_3_medium_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_3_medium_idea
                add_idea = HAM_hamway_star_opposition_2_medium_idea
            }
        }
        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_3_strenght_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_3_strenght_idea
                add_idea = HAM_hamway_star_opposition_2_strenght_idea
            }
        }
        


        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_1_weak_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_1_weak_idea
                add_idea = HAM_hamway_star_opposition_2_weak_idea
            }
        }
        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_1_medium_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_1_medium_idea
                add_idea = HAM_hamway_star_opposition_2_medium_idea
            }
        }
        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_1_strenght_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_1_strenght_idea
                add_idea = HAM_hamway_star_opposition_2_strenght_idea
            }
        }

        
    }

	if = {
        limit = { check_variable = { star_opposition_ideas_new_state = 1}}

        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_2_weak_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_2_weak_idea
                add_idea = HAM_hamway_star_opposition_1_weak_idea
            }
        }
        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_2_medium_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_2_medium_idea
                add_idea = HAM_hamway_star_opposition_1_medium_idea
            }
        }
        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_2_strenght_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_2_strenght_idea
                add_idea = HAM_hamway_star_opposition_1_strenght_idea
            }
        }



        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_3_weak_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_3_weak_idea
                add_idea = HAM_hamway_star_opposition_1_weak_idea
            }
        }
        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_3_medium_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_3_medium_idea
                add_idea = HAM_hamway_star_opposition_1_medium_idea
            }
        }
        if = {
            limit = {
                has_idea = HAM_hamway_star_opposition_3_strenght_idea
            }
            swap_ideas = {
                remove_idea = HAM_hamway_star_opposition_3_strenght_idea
                add_idea = HAM_hamway_star_opposition_1_strenght_idea
            }
        }

        
    }


    set_variable = { star_opposition_ideas_new_state = 0 }
}

star_opposition_ideas_increase_activity = {

    if = {
        limit = {
            has_idea = HAM_hamway_star_opposition_2_medium_idea
        }
        swap_ideas = {
            remove_idea = HAM_hamway_star_opposition_2_medium_idea
            add_idea = HAM_hamway_star_opposition_2_strenght_idea
        }
    }
    if = {
        limit = {
            has_idea = HAM_hamway_star_opposition_2_weak_idea
        }
        swap_ideas = {
            remove_idea = HAM_hamway_star_opposition_2_weak_idea
            add_idea = HAM_hamway_star_opposition_2_medium_idea
        }
    }
    

    if = {
        limit = {
            has_idea = HAM_hamway_star_opposition_3_medium_idea
        }
        swap_ideas = {
            remove_idea = HAM_hamway_star_opposition_3_medium_idea
            add_idea = HAM_hamway_star_opposition_3_strenght_idea
        }
    }
    if = {
        limit = {
            has_idea = HAM_hamway_star_opposition_3_weak_idea
        }
        swap_ideas = {
            remove_idea = HAM_hamway_star_opposition_3_weak_idea
            add_idea = HAM_hamway_star_opposition_3_medium_idea
        }
    }
    
    

    if = {
        limit = {
            has_idea = HAM_hamway_star_opposition_1_medium_idea
        }
        swap_ideas = {
            remove_idea = HAM_hamway_star_opposition_1_medium_idea
            add_idea = HAM_hamway_star_opposition_1_strenght_idea
        }
    }
    if = {
        limit = {
            has_idea = HAM_hamway_star_opposition_1_weak_idea
        }
        swap_ideas = {
            remove_idea = HAM_hamway_star_opposition_1_weak_idea
            add_idea = HAM_hamway_star_opposition_1_medium_idea
        }
    }
}

star_opposition_ideas_decrease_activity = {
    # Уровень 3 -> понижаем активность
    if = {
        limit = {
            has_idea = HAM_hamway_star_opposition_3_strenght_idea
        }
        swap_ideas = {
            remove_idea = HAM_hamway_star_opposition_3_strenght_idea
            add_idea = HAM_hamway_star_opposition_3_medium_idea
        }
    }
    if = {
        limit = {
            has_idea = HAM_hamway_star_opposition_3_medium_idea
        }
        swap_ideas = {
            remove_idea = HAM_hamway_star_opposition_3_medium_idea
            add_idea = HAM_hamway_star_opposition_3_weak_idea
        }
    }
    
    # Уровень 2 -> понижаем активность
    if = {
        limit = {
            has_idea = HAM_hamway_star_opposition_2_strenght_idea
        }
        swap_ideas = {
            remove_idea = HAM_hamway_star_opposition_2_strenght_idea
            add_idea = HAM_hamway_star_opposition_2_medium_idea
        }
    }
    if = {
        limit = {
            has_idea = HAM_hamway_star_opposition_2_medium_idea
        }
        swap_ideas = {
            remove_idea = HAM_hamway_star_opposition_2_medium_idea
            add_idea = HAM_hamway_star_opposition_2_weak_idea
        }
    }
    
    # Уровень 1 -> понижаем активность
    if = {
        limit = {
            has_idea = HAM_hamway_star_opposition_1_strenght_idea
        }
        swap_ideas = {
            remove_idea = HAM_hamway_star_opposition_1_strenght_idea
            add_idea = HAM_hamway_star_opposition_1_medium_idea
        }
    }
    if = {
        limit = {
            has_idea = HAM_hamway_star_opposition_1_medium_idea
        }
        swap_ideas = {
            remove_idea = HAM_hamway_star_opposition_1_medium_idea
            add_idea = HAM_hamway_star_opposition_1_weak_idea
        }
    }
}

star_opposition_set_advisor_betsy = {

    if = {
        limit = {
                check_variable = { HAM_STAR_lefthand = 1 }
                NOT = { check_variable = { HAM_STAR_righthand = 1 } }
        }
        set_variable = { HAM_STAR_lefthand = 7 }
        add_ideas = HAM_betsy_buff
    }

    if = {
        limit = {
                check_variable = { HAM_STAR_righthand = 1 }
                NOT = { check_variable = { HAM_STAR_lefthand = 1 } }
        }
        set_variable = { HAM_STAR_righthand = 7 }
        add_ideas = HAM_betsy_buff
    }

    if = {
        limit = {
                check_variable = { HAM_STAR_righthand = 1 }
                check_variable = { HAM_STAR_lefthand = 1 }
        }
        set_variable = { HAM_STAR_lefthand = 7 }
        add_ideas = HAM_betsy_buff
    }

    if = {
        limit = {
            AND = {
                NOT = { check_variable = { HAM_STAR_righthand = 1 } }
                NOT = { check_variable = { HAM_STAR_lefthand = 1 } }
            }
        }

        if = {
            limit = {
                #IF RIGHT
                check_variable = { HAM_STAR_lastside = 2 }
            }
            star_opposition_clear_left_advisor = yes
            set_variable = { HAM_STAR_lefthand = 7 }
            set_variable = { HAM_STAR_lastside = 1 }
            add_ideas = HAM_betsy_buff
        }
        else = { #if left
            star_opposition_clear_right_advisor = yes
            set_variable = { HAM_STAR_righthand = 7 }
            set_variable = { HAM_STAR_lastside = 2 }
            add_ideas = HAM_betsy_buff
        }
    }
}

star_opposition_set_advisor_lokel = {

    if = {
        limit = {
                check_variable = { HAM_STAR_lefthand = 1 }
                NOT = { check_variable = { HAM_STAR_righthand = 1 } }
        }
        set_variable = { HAM_STAR_lefthand = 6 }
        add_ideas = HAM_lokel_buff
    }

    if = {
        limit = {
                check_variable = { HAM_STAR_righthand = 1 }
                NOT = { check_variable = { HAM_STAR_lefthand = 1 } }
        }
        set_variable = { HAM_STAR_righthand = 6 }
        add_ideas = HAM_lokel_buff
    }

    if = {
        limit = {
                check_variable = { HAM_STAR_righthand = 1 }
                check_variable = { HAM_STAR_lefthand = 1 }
        }
        set_variable = { HAM_STAR_lefthand = 6 }
        add_ideas = HAM_lokel_buff
    }

    if = {
        limit = {
            AND = {
                NOT = { check_variable = { HAM_STAR_righthand = 1 } }
                NOT = { check_variable = { HAM_STAR_lefthand = 1 } }
            }
        }

        if = {
            limit = {
                #IF RIGHT
                check_variable = { HAM_STAR_lastside = 2 }
            }
            star_opposition_clear_left_advisor = yes
            set_variable = { HAM_STAR_lefthand = 6 }
            set_variable = { HAM_STAR_lastside = 1 }
            add_ideas = HAM_lokel_buff
        }
        else = { #if left
            star_opposition_clear_right_advisor = yes
            set_variable = { HAM_STAR_righthand = 6 }
            set_variable = { HAM_STAR_lastside = 2 }
            add_ideas = HAM_lokel_buff
        }
    }
}

star_opposition_set_advisor_vikishow = {
    if = {
        limit = {
                check_variable = { HAM_STAR_lefthand = 1 }
                NOT = { check_variable = { HAM_STAR_righthand = 1 } }
        }
        set_variable = { HAM_STAR_lefthand = 5 }
        add_ideas = HAM_vikishow_buff
    }

    if = {
        limit = {
                check_variable = { HAM_STAR_righthand = 1 }
                NOT = { check_variable = { HAM_STAR_lefthand = 1 } }
        }
        set_variable = { HAM_STAR_righthand = 5 }
        add_ideas = HAM_vikishow_buff
    }

    if = {
        limit = {
                check_variable = { HAM_STAR_righthand = 1 }
                check_variable = { HAM_STAR_lefthand = 1 }
        }
        set_variable = { HAM_STAR_lefthand = 5 }
        add_ideas = HAM_vikishow_buff
    }

    if = {
        limit = {
            AND = {
                NOT = { check_variable = { HAM_STAR_righthand = 1 } }
                NOT = { check_variable = { HAM_STAR_lefthand = 1 } }
            }
        }

        if = {
            limit = {
                #IF RIGHT
                check_variable = { HAM_STAR_lastside = 2 }
            }
            star_opposition_clear_left_advisor = yes
            set_variable = { HAM_STAR_lefthand = 5 }
            set_variable = { HAM_STAR_lastside = 1 }
            add_ideas = HAM_vikishow_buff
        }
        else = { #if left
            star_opposition_clear_right_advisor = yes
            set_variable = { HAM_STAR_righthand = 5 }
            set_variable = { HAM_STAR_lastside = 2 }
            add_ideas = HAM_vikishow_buff
        }
    }
}

star_opposition_set_advisor_amirchik = {
    if = {
        limit = {
                check_variable = { HAM_STAR_lefthand = 1 }
                NOT = { check_variable = { HAM_STAR_righthand = 1 } }
        }
        set_variable = { HAM_STAR_lefthand = 4 }
        add_ideas = HAM_amirchik_buff
    }

    if = {
        limit = {
                check_variable = { HAM_STAR_righthand = 1 }
                NOT = { check_variable = { HAM_STAR_lefthand = 1 } }
        }
        set_variable = { HAM_STAR_righthand = 4 }
        add_ideas = HAM_amirchik_buff
    }

    if = {
        limit = {
                check_variable = { HAM_STAR_righthand = 1 }
                check_variable = { HAM_STAR_lefthand = 1 }
        }
        set_variable = { HAM_STAR_lefthand = 4 }
        add_ideas = HAM_amirchik_buff
    }

    if = {
        limit = {
            AND = {
                NOT = { check_variable = { HAM_STAR_righthand = 1 } }
                NOT = { check_variable = { HAM_STAR_lefthand = 1 } }
            }
        }

        if = {
            limit = {
                #IF RIGHT
                check_variable = { HAM_STAR_lastside = 2 }
            }
            star_opposition_clear_left_advisor = yes
            set_variable = { HAM_STAR_lefthand = 4 }
            set_variable = { HAM_STAR_lastside = 1 }
            add_ideas = HAM_amirchik_buff
        }
        else = { #if left
            star_opposition_clear_right_advisor = yes
            set_variable = { HAM_STAR_righthand = 4 }
            set_variable = { HAM_STAR_lastside = 2 }
            add_ideas = HAM_amirchik_buff
        }
    }
}

star_opposition_set_advisor_irinamairko = {
    if = {
        limit = {
                check_variable = { HAM_STAR_lefthand = 1 }
                NOT = { check_variable = { HAM_STAR_righthand = 1 } }
        }
        set_variable = { HAM_STAR_lefthand = 3 }
        add_ideas = HAM_mairko_buff
    }

    if = {
        limit = {
                check_variable = { HAM_STAR_righthand = 1 }
                NOT = { check_variable = { HAM_STAR_lefthand = 1 } }
        }
        set_variable = { HAM_STAR_righthand = 3 }
        add_ideas = HAM_mairko_buff
    }

    if = {
        limit = {
                check_variable = { HAM_STAR_righthand = 1 }
                check_variable = { HAM_STAR_lefthand = 1 }
        }
        set_variable = { HAM_STAR_lefthand = 3 }
        add_ideas = HAM_mairko_buff
    }

    if = {
        limit = {
            AND = {
                NOT = { check_variable = { HAM_STAR_righthand = 1 } }
                NOT = { check_variable = { HAM_STAR_lefthand = 1 } }
            }
        }

        if = {
            limit = {
                #IF RIGHT
                check_variable = { HAM_STAR_lastside = 2 }
            }
            star_opposition_clear_left_advisor = yes
            set_variable = { HAM_STAR_lefthand = 3 }
            set_variable = { HAM_STAR_lastside = 1 }
            add_ideas = HAM_mairko_buff
        }
        else = { #if left
            star_opposition_clear_right_advisor = yes
            set_variable = { HAM_STAR_righthand = 3 }
            set_variable = { HAM_STAR_lastside = 2 }
            add_ideas = HAM_mairko_buff
        }
    }
}


star_opposition_set_advisor_filimonova = {
    if = {
        limit = {
                check_variable = { HAM_STAR_lefthand = 1 }
                NOT = { check_variable = { HAM_STAR_righthand = 1 } }
        }
        set_variable = { HAM_STAR_lefthand = 2 }
        add_ideas = HAM_filimonova_buff
    }

    if = {
        limit = {
                check_variable = { HAM_STAR_righthand = 1 }
                NOT = { check_variable = { HAM_STAR_lefthand = 1 } }
        }
        set_variable = { HAM_STAR_righthand = 2 }
        add_ideas = HAM_filimonova_buff
    }

    if = {
        limit = {
                check_variable = { HAM_STAR_righthand = 1 }
                check_variable = { HAM_STAR_lefthand = 1 }
        }
        set_variable = { HAM_STAR_lefthand = 2 }
        add_ideas = HAM_filimonova_buff
    }

    if = {
        limit = {
            AND = {
                NOT = { check_variable = { HAM_STAR_righthand = 1 } }
                NOT = { check_variable = { HAM_STAR_lefthand = 1 } }
            }
        }

        if = {
            limit = {
                #IF RIGHT
                check_variable = { HAM_STAR_lastside = 2 }
            }
            star_opposition_clear_left_advisor = yes
            set_variable = { HAM_STAR_lefthand = 2 }
            set_variable = { HAM_STAR_lastside = 1 }
            add_ideas = HAM_filimonova_buff
        }
        else = { #if left
            star_opposition_clear_right_advisor = yes
            set_variable = { HAM_STAR_righthand = 2 }
            set_variable = { HAM_STAR_lastside = 2 }
            add_ideas = HAM_filimonova_buff
        }
    }
}

star_opposition_clear_left_advisor = {
    if = {
        limit = {
            check_variable = { HAM_STAR_lefthand = 2 }
        }
        remove_ideas = HAM_filimonova_buff
    }
    if = {
        limit = {
            check_variable = { HAM_STAR_lefthand = 3 }
        }
        remove_ideas = HAM_mairko_buff
    }
    if = {
        limit = {
            check_variable = { HAM_STAR_lefthand = 4 }
        }
        remove_ideas = HAM_amirchik_buff
    }
    if = {
        limit = {
            check_variable = { HAM_STAR_lefthand = 5 }
        }
        remove_ideas = HAM_vikishow_buff
    }
    if = {
        limit = {
            check_variable = { HAM_STAR_lefthand = 6 }
        }
        remove_ideas = HAM_lokel_buff
    }
    if = {
        limit = {
            check_variable = { HAM_STAR_lefthand = 7 }
        }
        remove_ideas = HAM_betsy_buff
    }

    set_variable = { HAM_STAR_lefthand = 1 }
}

star_opposition_clear_right_advisor = {
    if = {
        limit = {
            check_variable = { HAM_STAR_righthand = 2 }
        }
        remove_ideas = HAM_filimonova_buff
    }
    if = {
        limit = {
            check_variable = { HAM_STAR_righthand = 3 }
        }
        remove_ideas = HAM_mairko_buff
    }
    if = {
        limit = {
            check_variable = { HAM_STAR_righthand = 4 }
        }
        remove_ideas = HAM_amirchik_buff
    }
    if = {
        limit = {
            check_variable = { HAM_STAR_righthand = 5 }
        }
        remove_ideas = HAM_vikishow_buff
    }
    if = {
        limit = {
            check_variable = { HAM_STAR_righthand = 6 }
        }
        remove_ideas = HAM_lokel_buff
    }
    if = {
        limit = {
            check_variable = { HAM_STAR_righthand = 7 }
        }
        remove_ideas = HAM_betsy_buff
    }

    set_variable = { HAM_STAR_righthand = 1 }
}

HAM_hametova_elected = {
    HAM = {
        set_country_flag = HAM_HAMETOVA_ELECTED
    }
}

HAM_star_elected = {
    HAM = {
        set_country_flag = HAM_STAR_ELECTED
        clr_country_flag = HAM_star_opposition_way
        
        # Смена правительства на демократическое
        set_politics = {
            ruling_party = democratic
            elections_allowed = no
        }
        
        # Смена лидера на Милану Стар
        create_country_leader = {
            name = "Милана Стар"
            desc = "HAM_milana_star_desc"
            picture = "gfx/leaders/HAM/star.dds"
            expire = "1965.1.1"
            ideology = liberalism
            traits = {
                democratic_reformer
            }
        }
        
        # Бонусы за победу демократии
        add_stability = 0.1
        add_political_power = 100
        
        # Убрать идеи авторитаризма
        if = { limit = { has_idea = HAM_siloviki_victory } remove_ideas = HAM_siloviki_victory }
        if = { limit = { has_idea = HAM_internet_blocking } remove_ideas = HAM_internet_blocking }
        if = { limit = { has_idea = HAM_organized_fso } remove_ideas = HAM_organized_fso }
        if = { limit = { has_idea = HAM_reformed_police } remove_ideas = HAM_reformed_police }
        
        # Обнулить интерес силовиков - они больше не угроза
        set_variable = { HAM_STAR_siloviki_interes = 0 }
        
        # Сбросить все флаги стадий силовиков
        clr_country_flag = HAM_siloviki_stage_1
        clr_country_flag = HAM_siloviki_stage_2
        clr_country_flag = HAM_siloviki_stage_3
        clr_country_flag = HAM_siloviki_stage_4
        clr_country_flag = HAM_siloviki_stage_5
        clr_country_flag = HAM_siloviki_stage_final
        
        # Сбросить кулдаун советников (если был)
        clr_country_flag = HAM_STAR_ADVISOR_SET_COOLDOWN
        set_variable = { HAM_STAR_COOLDOWN = 0 }
        
        # Отключить советников Хаметовой
        set_country_flag = ham_dava_disable
        set_country_flag = ham_kamil_disable
        set_country_flag = ham_lera_simka_disable
        set_country_flag = ham_amina_kikido_disable
        set_country_flag = ham_nastya_knyzeva_disable
        
        # Убрать советников Хаметовой из правительства
        if = { limit = { has_idea = ham_dava } remove_ideas = ham_dava }
        if = { limit = { has_idea = ham_kamil_kikido } remove_ideas = ham_kamil_kikido }
        if = { limit = { has_idea = ham_lera_simka } remove_ideas = ham_lera_simka }
        if = { limit = { has_idea = ham_amina_kikido } remove_ideas = ham_amina_kikido }
        if = { limit = { has_idea = ham_nastya_knyzeva } remove_ideas = ham_nastya_knyzeva }
        
        # Разблокировать советников Стар
        clr_country_flag = ham_nekrasova_disable
        
        # Добавить идею победы демократии
        add_ideas = HAM_democratic_victory
    }
}

HAM_hametova_final_victory = {
    HAM = {
        set_country_flag = HAM_HAMETOVA_FINAL_VICTORY
        set_country_flag = HAM_NO_MORE_ELECTIONS
        
        # Усиление хайпократии
        add_popularity = {
            ideology = hypecratia
            popularity = 0.1
        }
        
        # Ослабление демократии
        add_popularity = {
            ideology = democratic
            popularity = -0.05
        }
        
        # Удалить все идеи оппозиции после победы
        if = { limit = { has_idea = HAM_hamway_star_opposition_1_weak_idea } remove_ideas = HAM_hamway_star_opposition_1_weak_idea }
        if = { limit = { has_idea = HAM_hamway_star_opposition_1_medium_idea } remove_ideas = HAM_hamway_star_opposition_1_medium_idea }
        if = { limit = { has_idea = HAM_hamway_star_opposition_1_strenght_idea } remove_ideas = HAM_hamway_star_opposition_1_strenght_idea }
        if = { limit = { has_idea = HAM_hamway_star_opposition_2_weak_idea } remove_ideas = HAM_hamway_star_opposition_2_weak_idea }
        if = { limit = { has_idea = HAM_hamway_star_opposition_2_medium_idea } remove_ideas = HAM_hamway_star_opposition_2_medium_idea }
        if = { limit = { has_idea = HAM_hamway_star_opposition_2_strenght_idea } remove_ideas = HAM_hamway_star_opposition_2_strenght_idea }
        if = { limit = { has_idea = HAM_hamway_star_opposition_3_weak_idea } remove_ideas = HAM_hamway_star_opposition_3_weak_idea }
        if = { limit = { has_idea = HAM_hamway_star_opposition_3_medium_idea } remove_ideas = HAM_hamway_star_opposition_3_medium_idea }
        if = { limit = { has_idea = HAM_hamway_star_opposition_3_strenght_idea } remove_ideas = HAM_hamway_star_opposition_3_strenght_idea }
        
        # Заблокировать советников Стар
        set_country_flag = ham_filimonova_disable
        set_country_flag = ham_star_mom_disable
        set_country_flag = ham_amirchik_disable
        set_country_flag = ham_nekrasova_disable
        
        # Удалить советников Стар из правительства
        if = { limit = { has_idea = ham_filimonova } remove_ideas = ham_filimonova }
        if = { limit = { has_idea = ham_star_mom } remove_ideas = ham_star_mom }
        if = { limit = { has_idea = ham_nekrasova } remove_ideas = ham_nekrasova }
        
        hidden_effect = {
            country_event = { id = hametova_elections.25 days = 2 }
        }
    }
}